{% extends 'base.html'%}
{% block content %}
<div class="container-fluid">

    <div class="row">
        <div class="col-md-8">
            <!-- Formulario a la izquierda -->
            <div class="container">
                <!--img src="{{ url_for('static', filename='website/resources/static/img.png') }}" alt="Logo of the app"-->
                <h2 class="mb-5">Search your best route!</h2> <!-- mb-X aumenta el margen-->

                <form action="" method='POST' name="myform">
                    {{ form.csrf_token }}
                    <div class="mb-3 d-flex align-items-center">
                        {{ form.startdate.label(style="width: 100px")}}
                        {{ form.startdate(class='datepicker', style="width:200px")}} {{ form.hidden_tag() }}
                    </div>
                    <div class="mb-3 d-flex align-items-center">
                        {{ form.destination.label(class="me-2", style="width: 100px") }}
                        {{ form.destination(class="form-select form-control form-control-sm me-2", style="width: 200px", id="id_destination") }}
                    </div>

                    <div class="mb-3 d-flex align-items-center">
                        {{ form.people.label(class="me-2", style="width: 100px") }}
                        {{ form.people(class="form-select form-control form-control-sm me-2", style="width: 200px") }}
                    </div>

                    <div class="mb-3 d-flex align-items-center">
                        {{ form.days.label(class="me-2", style="width: 100px") }}
                        {{ form.days(class="form-select form-control form-control-sm me-2", style="width: 200px") }}
                    </div>

                    <div class="mb-3 d-flex align-items-center">
                        {{ form.type_trip.label(class="me-2", style="width: 100px") }}
                        {{ form.type_trip(class="form-select form-control form-control-sm me-2", style="width: 200px") }}
                    </div>

                    {{ form.submit(class="btn btn-primary") }}
                </form>
            </div>
        </div>
        <div class="col-md-4">
            <!-- Poner mapa a la derecha -->
            <div id="map" style="height: 400px;"></div>
        </div>
    </div>

</div>

<!-- Agregar el script de Google Maps API con tu clave API -->
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAV50jKxT5jnmiIYR-EOCwtUZwkzsIxHwA&libraries=places&callback=initMap" async defer></script>

<!-- Agregar el script para manejar el mapa -->
<script>
    var map;

    function initMap() {
        map = new google.maps.Map(document.getElementById('map'), {
            center: {lat: -34.397, lng: 150.644},
            zoom: 8
        });

        // Función para actualizar el mapa según la dirección de destino
        function updateMap(destination) {
            var geocoder = new google.maps.Geocoder();

            // Convierte la dirección en coordenadas
            geocoder.geocode({'address': destination}, function(results, status) {
                if (status === 'OK') {
                    map.setCenter(results[0].geometry.location);
                    var marker = new google.maps.Marker({
                        map: map,
                        position: results[0].geometry.location
                    });
                } else {
                    alert('Geocode was not successful for the following reason: ' + status);
                }
            });
        }

        // Llama a updateMap cuando se cambia el valor del campo destination
        document.addEventListener('DOMContentLoaded', function() {
            var destinationInput = document.querySelector('#id_destination'); // Ajusta el selector según tu formulario
            destinationInput.addEventListener('change', function() {
                updateMap(destinationInput.value);
            });
        });
    }
</script>

{% endblock %}
